import { FortuneData } from "../types";

// 25 Мистических прилагательных (мужской род)
const ADJECTIVES = [
  "Звездный", "Лунный", "Забытый", "Вечный", "Хрустальный", 
  "Багровый", "Изумрудный", "Золотой", "Небесный", "Тайный", 
  "Мистический", "Древний", "Безмолвный", "Спящий", "Огненный", 
  "Серебряный", "Темный", "Светлый", "Астральный", "Истинный", 
  "Скрытый", "Мерцающий", "Священный", "Загадочный", "Мудрый"
];

// 20 Мистических существительных (мужской род для точного склонения)
const NOUNS = [
  "Лотос", "Ворон", "Путник", "Маятник", "Компас", 
  "Ключ", "Мост", "Океан", "Лес", "Феникс", 
  "Дракон", "Меч", "Кубок", "Посох", "Амулет", 
  "Кристалл", "Лабиринт", "Цветок", "Огонь", "Ветер"
];

// 25 Глубоких начал предсказания (Ситуация / Энергия)
const SENTENCE_1 = [
  "Время сомнений подходит к концу.",
  "Твоя интуиция сейчас острее, чем когда-либо.",
  "Впереди неожиданный поворот судьбы.",
  "То, что ты ищешь, уже ищет тебя.",
  "Прошлое отпускает свою хватку.",
  "Вселенная приготовила для тебя особый дар.",
  "Твои недавние усилия скоро принесут плоды.",
  "Наступает период глубокого внутреннего исцеления.",
  "Скрытые истины скоро выйдут на свет.",
  "Ты стоишь на пороге важного открытия.",
  "Энергия вокруг тебя меняет свое направление.",
  "Твой внутренний голос подсказывает верный путь.",
  "Грядут перемены, о которых ты давно просил.",
  "Препятствия на твоем пути растворяются.",
  "Новый цикл твоей жизни уже начался.",
  "Звезды выстраиваются в твою пользу.",
  "То, что казалось потерей, обернется приобретением.",
  "Твоя энергия притягивает нужных людей.",
  "Сейчас идеальное время для смелых шагов.",
  "Ответ, который ты ищешь, лежит на поверхности.",
  "Гармония возвращается в твою жизнь.",
  "Твои сны сейчас полны важных подсказок.",
  "Светлые силы незримо поддерживают тебя.",
  "Ты обладаешь всем необходимым для победы.",
  "Твой потенциал готов раскрыться в полной мере."
];

// 20 Мудрых завершений (Совет / Действие)
const SENTENCE_2 = [
  "Сделай шаг в неизвестность без страха.",
  "Позволь вселенной вести тебя.",
  "Открой сердце для новых чудес.",
  "Сохраняй внутренний покой.",
  "Твоя сила — в твоей искренности.",
  "Доверься процессу и не торопи события.",
  "Отпусти контроль и наблюдай за магией.",
  "Прислушайся к тишине внутри себя.",
  "Будь готов принять дары судьбы.",
  "Прояви терпение, и все сложится идеально.",
  "Действуй мягко, но уверенно.",
  "Твоя вера в себя разрушит любые преграды.",
  "Оставь страхи в прошлом.",
  "Смотри на мир с открытой душой.",
  "Позволь себе быть настоящим.",
  "Ищи ответы в простых вещах.",
  "Направь свою энергию на созидание.",
  "Помни, что ты часть чего-то большего.",
  "Твой свет способен разогнать любую тьму.",
  "Каждый твой шаг сейчас благословен."
];

// Генерация ровно 500 уникальных карт (25 * 20 = 500)
const ALL_CARDS: FortuneData[] = [];
for (let i = 0; i < ADJECTIVES.length; i++) {
  for (let j = 0; j < NOUNS.length; j++) {
    ALL_CARDS.push({
      cardName: `${ADJECTIVES[i]} ${NOUNS[j]}`,
      text: `${SENTENCE_1[i]} ${SENTENCE_2[j]}`,
      imageUrl: "" // Без картинки будет использоваться красивая мистическая векторная иконка из TarotReveal
    });
  }
}

let lastIndex = -1;

export const fetchFortune = async (): Promise<FortuneData> => {
  // Искусственная задержка (600мс), чтобы сохранить эффект "магии" и плавность анимации загрузки
  await new Promise(resolve => setTimeout(resolve, 600));

  // Выбираем случайную карту из 500
  let randomIndex = Math.floor(Math.random() * ALL_CARDS.length);
  
  // Защита от выпадения одной и той же карты дважды подряд
  while (randomIndex === lastIndex) {
    randomIndex = Math.floor(Math.random() * ALL_CARDS.length);
  }
  
  lastIndex = randomIndex;
  return ALL_CARDS[randomIndex];
};
